export default {
    async fetch(request, env, ctx) {
      const url = new URL(request.url);
      const searchUrl = url.searchParams.get('target');
      if (!searchUrl) {
        return new Response('Missing ?target=...', { status: 400 });
      }
  
      // Fetch the Rightmove page
      const resp = await fetch(searchUrl, {
        headers: {
          // Simulate browser headers for best results
          'User-Agent': 'Mozilla/5.0 (compatible; Cloudflare-Worker/1.0; +https://workers.cloudflare.com/)',
          'Accept': 'text/html'
        }
      });
      const html = await resp.text();
  
      // Basic property parsing (improve as needed)
      const regex = /<a[^>]+class="propertyCard-link"[^>]+href="([^"]+)"[^>]*>([\\s\\S]*?)<\\/a>[\\s\\S]*?<span[^>]*class="propertyCard-priceValue"[^>]*>([^<]+)<\\/span>[\\s\\S]*?<h2[^>]*class="propertyCard-title"[^>]*>([^<]+)<\\/h2>/g;
      let match, results = [];
      while ((match = regex.exec(html)) !== null) {
        results.push({
          url: 'https://www.rightmove.co.uk' + match[1],
          price: match[3].replace(/\\D/g, ''),
          title: match[4].trim()
        });
      }
  
      return Response.json(results);
    }
  }
